// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Tabella principale prodotti
model Product {
  id          Int       @id @default(autoincrement())
  nome        String
  prezzo      Float     // Prezzo minimo (della variante pi√π piccola)
  immagine    String
  popolarita  Int       @default(999)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  attributes  ProductAttribute[]
  varianti    ProductVariant[]

  @@map("products")
}

// Tabella EAV per attributi flessibili (ingredienti, conservazione, ecc.)
model ProductAttribute {
  id          Int      @id @default(autoincrement())
  productId   Int
  attributeName String  // es: "ingredienti", "conservazione", "allergeni", ecc.
  attributeValue String @db.Text // Valore dell'attributo

  product     Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@map("product_attributes")
  @@index([productId])
  @@index([attributeName])
}

// Tabella varianti peso/prezzo/tipo
model ProductVariant {
  id          Int      @id @default(autoincrement())
  productId   Int
  tipo        String?  // es: "Bianca", "Affumicata" (opzionale, non tutti i prodotti hanno tipo)
  peso        String   // es: "125g", "250g", "1kg"
  prezzo      Float
  prezzoKg    Float?   // Prezzo al kg (opzionale, per visualizzarlo)

  product     Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@map("product_variants")
  @@index([productId])
}
